{
        "info": {
                "_postman_id": "txdxai-api-collection",
                "name": "TxDxAI API - Configuraci√≥n B√°sica",
                "description": "Colecci√≥n de endpoints para la API de TxDxAI - Sistema de ciberseguridad y automatizaci√≥n de TIC con agentes SOPHIA.\n\n## üîê Multi-Dispositivo: Recuperaci√≥n de Agent Access Key\n\n**PROBLEMA RESUELTO:** Ahora puedes recuperar tu `agent_access_key` en cualquier dispositivo sin recrear la instancia.\n\n### ¬øC√≥mo funciona?\n1. Creas tu agente una vez ‚Üí Recibes el `agent_access_key`\n2. La key se guarda **encriptada** en la base de datos (AES-256 Fernet)\n3. Desde cualquier dispositivo:\n   - Login con tu usuario ADMIN\n   - Llama `GET /api/admin/agent-instances/:id/access-key`\n   - Recibes tu key original desencriptada\n\n### Seguridad:\n- Solo usuarios ADMIN de la misma compa√±√≠a\n- Key encriptada con Fernet (clave persistente en `AGENT_KEY_ENCRYPTION_KEY`)\n- Hash bcrypt para autenticaci√≥n del agente\n\n## Configuraci√≥n B√°sica\n- Incluye configuraci√≥n b√°sica (OpenAI + Search + Speech)\n- NO requiere Azure AI Agent Framework\n- Es la misma configuraci√≥n que usa el panel de admin b√°sico",
                "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
        },
        "item": [
                {
                        "name": "1. Auth (Autenticaci√≥n)",
                        "item": [
                                {
                                        "name": "Register (Registrar Admin + Empresa)",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 201) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"access_token\", jsonData.access_token);",
                                                                        "    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
                                                                        "    console.log(\"Token guardado: \" + jsonData.access_token);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"company_name\": \"Mi Empresa Tech\",\n  \"username\": \"admin\",\n  \"email\": \"admin@miempresa.com\",\n  \"password\": \"SecurePass123!\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/auth/register",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "auth", "register"]
                                                },
                                                "description": "Registra un nuevo admin y crea una empresa. Retorna access_token y refresh_token."
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Login",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 200) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"access_token\", jsonData.access_token);",
                                                                        "    pm.environment.set(\"refresh_token\", jsonData.refresh_token);",
                                                                        "    console.log(\"Token guardado: \" + jsonData.access_token);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"SecurePass123!\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/auth/login",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "auth", "login"]
                                                },
                                                "description": "Login de usuario. Retorna access_token y refresh_token que se guardan autom√°ticamente."
                                        },
                                        "response": []
                                }
                        ],
                        "description": "Endpoints de autenticaci√≥n de usuarios (registro y login con JWT)"
                },
                {
                        "name": "2. Companies (Empresas)",
                        "item": [
                                {
                                        "name": "Get Companies",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/companies",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "companies"]
                                                },
                                                "description": "Obtiene la empresa del usuario autenticado (solo ADMIN puede ver su empresa)"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Company by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/companies/:company_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "companies", ":company_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "company_id",
                                                                        "value": "1",
                                                                        "description": "ID de la empresa"
                                                                }
                                                        ]
                                                },
                                                "description": "Obtiene los detalles de una empresa espec√≠fica"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Update Company",
                                        "request": {
                                                "method": "PUT",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"name\": \"Mi Empresa Tech Solutions\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/companies/:company_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "companies", ":company_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "company_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                },
                                                "description": "Actualiza el nombre de la empresa (requiere rol ADMIN)"
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "3. Users (Usuarios)",
                        "item": [
                                {
                                        "name": "Get Users",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/users",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "users"]
                                                },
                                                "description": "Obtiene todos los usuarios de la empresa"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get User by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/users/:user_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "users", ":user_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "user_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Create User",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"username\": \"operador1\",\n  \"email\": \"operador1@miempresa.com\",\n  \"password\": \"Pass123!\",\n  \"role\": \"USER\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/users",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "users"]
                                                },
                                                "description": "Crea un nuevo usuario (requiere rol ADMIN). Roles: ADMIN o USER"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Update User",
                                        "request": {
                                                "method": "PUT",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"email\": \"nuevo_email@miempresa.com\",\n  \"password\": \"NuevoPass123!\",\n  \"role\": \"ADMIN\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/users/:user_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "users", ":user_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "user_id",
                                                                        "value": "2"
                                                                }
                                                        ]
                                                },
                                                "description": "Actualiza usuario. ADMIN puede editar cualquiera, USER solo puede editarse a s√≠ mismo"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Delete User",
                                        "request": {
                                                "method": "DELETE",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/users/:user_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "users", ":user_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "user_id",
                                                                        "value": "2"
                                                                }
                                                        ]
                                                },
                                                "description": "Elimina un usuario (requiere rol ADMIN)"
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "4. Admin - Agent Instances (SOPHIA)",
                        "item": [
                                {
                                        "name": "Create Agent Instance (B√°sica)",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 201) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"agent_access_key\", jsonData.agent_access_key);",
                                                                        "    pm.environment.set(\"agent_instance_id\", jsonData.agent_instance.id);",
                                                                        "    console.log(\"Agent Access Key guardado: \" + jsonData.agent_access_key);",
                                                                        "    console.log(\"Agent Instance ID: \" + jsonData.agent_instance.id);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"azureOpenaiEndpoint\": \"https://tu-recurso.openai.azure.com/\",\n  \"azureOpenaiKey\": \"tu-azure-openai-key-aqui\",\n  \"azureOpenaiDeployment\": \"gpt-4\",\n  \n  \"azureSearchEndpoint\": \"https://tu-search.search.windows.net\",\n  \"azureSearchKey\": \"tu-azure-search-key-aqui\",\n  \n  \"azureSpeechEndpoint\": \"https://eastus.api.cognitive.microsoft.com/\",\n  \"azureSpeechKey\": \"tu-azure-speech-key-aqui\",\n  \"azureSpeechRegion\": \"eastus\",\n  \"azureSpeechVoiceName\": \"es-ES-ElviraNeural\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances"]
                                                },
                                                "description": "CREAR INSTANCIA DE AGENTE SOPHIA - CONFIGURACI√ìN B√ÅSICA\n\nEsta es la configuraci√≥n simplificada, igual a la del Admin Panel.\n\n**Par√°metros de Azure OpenAI (OBLIGATORIOS):**\n- azureOpenaiEndpoint: URL del recurso OpenAI en Azure\n- azureOpenaiKey: API Key de OpenAI (se guarda autom√°ticamente en KeyVault)\n- azureOpenaiDeployment: Nombre del deployment (ej: gpt-4, gpt-4o-mini)\n\n**Par√°metros de Azure AI Search (OPCIONALES - para RAG):**\n- azureSearchEndpoint: URL del servicio de b√∫squeda\n- azureSearchKey: API Key de Search (se guarda en KeyVault)\n\n**Par√°metros de Azure Speech (OPCIONALES - para voz):**\n- azureSpeechEndpoint: URL del servicio Speech\n- azureSpeechKey: API Key de Speech (se guarda en KeyVault)\n- azureSpeechRegion: Regi√≥n de Azure (ej: eastus, westeurope)\n- azureSpeechVoiceName: Voz en espa√±ol (default: es-ES-ElviraNeural)\n\n**IMPORTANTE:** \n- Todas las API keys se guardan autom√°ticamente en Azure KeyVault\n- Retorna un agent_access_key para autenticar el agente desde aplicaciones cliente\n- Esta configuraci√≥n NO requiere Azure AI Agent Framework\n- Suficiente para SOPHIA con LLM, b√∫squeda y voz"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Agent Instances",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances"]
                                                },
                                                "description": "Obtiene todas las instancias de agente de la empresa"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Agent Instance by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances/:instance_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances", ":instance_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Agent Access Key",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 200) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"agent_access_key\", jsonData.agent_access_key);",
                                                                        "    console.log(\"Agent Access Key recuperado: \" + jsonData.agent_access_key);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances/:instance_id/access-key",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances", ":instance_id", "access-key"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "{{agent_instance_id}}"
                                                                }
                                                        ]
                                                },
                                                "description": "RECUPERA EL AGENT ACCESS KEY de una instancia existente.\n\nEste endpoint te permite obtener el agent_access_key en cualquier momento:\n- Despu√©s de cerrar sesi√≥n\n- Desde otro dispositivo\n- Si perdiste la key original\n\nLa key est√° guardada encriptada en la base de datos y se desencripta cuando la pides.\n\n**Uso t√≠pico:**\n1. Login con tu usuario admin\n2. Llama este endpoint con el ID de tu agente\n3. Usa el agent_access_key para autenticar SOPHIA\n\n**No necesitas recrear la instancia nunca m√°s!**"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Rotate Agent Key",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 200) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"agent_access_key\", jsonData.agent_access_key);",
                                                                        "    console.log(\"Nuevo Agent Access Key: \" + jsonData.agent_access_key);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances/:instance_id/rotate-key",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances", ":instance_id", "rotate-key"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "{{agent_instance_id}}"
                                                                }
                                                        ]
                                                },
                                                "description": "Genera una nueva clave de acceso para el agente. La anterior deja de funcionar."
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Update Agent Instance",
                                        "request": {
                                                "method": "PATCH",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"status\": \"ACTIVE\",\n  \"azureOpenaiEndpoint\": \"https://nuevo-recurso.openai.azure.com/\",\n  \"azureOpenaiDeployment\": \"gpt-4o\",\n  \"azureSpeechVoiceName\": \"es-ES-AlvaroNeural\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances/:instance_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances", ":instance_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "{{agent_instance_id}}"
                                                                }
                                                        ]
                                                },
                                                "description": "Actualiza configuraci√≥n b√°sica del agente. Puedes actualizar: status (ACTIVE/DISABLED), endpoints de Azure, deployments, regi√≥n, voz, etc."
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Disable Agent Instance",
                                        "request": {
                                                "method": "DELETE",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/admin/agent-instances/:instance_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "admin", "agent-instances", ":instance_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "{{agent_instance_id}}"
                                                                }
                                                        ]
                                                },
                                                "description": "Deshabilita el agente (cambia status a DISABLED)"
                                        },
                                        "response": []
                                }
                        ],
                        "description": "Administraci√≥n de instancias de agentes SOPHIA (requiere rol ADMIN)"
                },
                {
                        "name": "5. Agents (Autenticaci√≥n de Agentes)",
                        "item": [
                                {
                                        "name": "Get Agent Token",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "if (pm.response.code === 200) {",
                                                                        "    var jsonData = pm.response.json();",
                                                                        "    pm.environment.set(\"agent_token\", jsonData.access_token);",
                                                                        "    console.log(\"Agent Token guardado: \" + jsonData.access_token);",
                                                                        "}"
                                                                ],
                                                                "type": "text/javascript"
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"companyId\": 1,\n  \"agentType\": \"SOPHIA\",\n  \"agentAccessKey\": \"{{agent_access_key}}\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/agents/auth/token",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "agents", "auth", "token"]
                                                },
                                                "description": "Obtiene un JWT para el agente. Este token tiene scope 'agent:invoke' y dura 1 hora.\n\nPARAMETROS:\n- companyId: ID de la empresa\n- agentType: SOPHIA (default)\n- agentAccessKey: La clave generada al crear la instancia\n\nRETORNA:\n- access_token: JWT del agente\n- agent_instance: Datos del agente incluyendo credenciales de Azure"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Agent Instance Metadata",
                                        "request": {
                                                "method": "GET",
                                                "header": [],
                                                "url": {
                                                        "raw": "{{base_url}}/api/agents/instance/:instance_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "agents", "instance", ":instance_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "instance_id",
                                                                        "value": "{{agent_instance_id}}"
                                                                }
                                                        ]
                                                },
                                                "description": "Obtiene metadata y credenciales del agente (endpoint p√∫blico, sin auth)"
                                        },
                                        "response": []
                                }
                        ],
                        "description": "Endpoints para autenticar agentes y obtener sus credenciales"
                },
                {
                        "name": "6. Tickets",
                        "item": [
                                {
                                        "name": "Get Tickets",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets?status=PENDING",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets"],
                                                        "query": [
                                                                {
                                                                        "key": "status",
                                                                        "value": "PENDING",
                                                                        "description": "Opcional: PENDING, EXECUTED, FAILED, DERIVED"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Ticket by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets/:ticket_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets", ":ticket_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "ticket_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Create Ticket",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"subject\": \"Alerta de seguridad detectada\",\n  \"description\": \"Se detect√≥ actividad sospechosa en el firewall\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets"]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Update Ticket",
                                        "request": {
                                                "method": "PUT",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"subject\": \"Alerta resuelta\",\n  \"description\": \"Se bloque√≥ la IP sospechosa\",\n  \"status\": \"EXECUTED\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets/:ticket_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets", ":ticket_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "ticket_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                },
                                                "description": "Status: PENDING, EXECUTED, FAILED, DERIVED"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Delete Ticket",
                                        "request": {
                                                "method": "DELETE",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets/:ticket_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets", ":ticket_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "ticket_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Agent Create Ticket",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{agent_token}}",
                                                                "description": "JWT del agente con scope agent:invoke"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"subject\": \"Ticket creado por SOPHIA\",\n  \"description\": \"El agente detect√≥ una vulnerabilidad cr√≠tica\",\n  \"userId\": 1,\n  \"severity\": \"critical\",\n  \"metadata\": {\n    \"source\": \"sophia\",\n    \"cve\": \"CVE-2024-1234\"\n  }\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/tickets/agent-create",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "tickets", "agent-create"]
                                                },
                                                "description": "Endpoint para que SOPHIA cree tickets. Requiere JWT de agente (usar /api/agents/auth/token primero)"
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "7. Integrations",
                        "item": [
                                {
                                        "name": "Get Integrations",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations"]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Integration by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations/:integration_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations", ":integration_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "integration_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Create Integration",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"provider\": \"splunk\",\n  \"name\": \"Splunk Principal\",\n  \"credentials\": {\n    \"api_key\": \"tu-splunk-api-key\",\n    \"url\": \"https://splunk.miempresa.com:8089\"\n  },\n  \"extra_json\": {\n    \"description\": \"Integraci√≥n principal de Splunk\"\n  }\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations"]
                                                },
                                                "description": "Providers: palo_alto, splunk, wazuh, meraki. Las credenciales se guardan en KeyVault."
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Update Integration",
                                        "request": {
                                                "method": "PUT",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        },
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"credentials\": {\n    \"api_key\": \"nueva-api-key\"\n  },\n  \"extra_json\": {\n    \"updated\": true\n  }\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations/:integration_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations", ":integration_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "integration_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Delete Integration",
                                        "request": {
                                                "method": "DELETE",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations/:integration_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations", ":integration_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "integration_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Integration Credentials",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/integrations/:integration_id/credentials",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "integrations", ":integration_id", "credentials"],
                                                        "variable": [
                                                                {
                                                                        "key": "integration_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                },
                                                "description": "Recupera las credenciales desde KeyVault"
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "8. Systems",
                        "item": [
                                {
                                        "name": "Get Systems Status",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/systems/status",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "systems", "status"]
                                                },
                                                "description": "Resumen de estado de todos los sistemas"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Systems",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/systems",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "systems"]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get System by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/systems/:system_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "systems", ":system_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "system_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "9. Alerts",
                        "item": [
                                {
                                        "name": "Get Active Alerts",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/alerts/active?limit=100",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "alerts", "active"],
                                                        "query": [
                                                                {
                                                                        "key": "limit",
                                                                        "value": "100",
                                                                        "description": "M√°ximo de alertas"
                                                                },
                                                                {
                                                                        "key": "since",
                                                                        "value": "2024-01-01T00:00:00Z",
                                                                        "description": "Fecha desde (ISO 8601)",
                                                                        "disabled": true
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Resolve Alert",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/alerts/:alert_id/resolve",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "alerts", ":alert_id", "resolve"],
                                                        "variable": [
                                                                {
                                                                        "key": "alert_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "10. Vulnerabilities",
                        "item": [
                                {
                                        "name": "Get Vulnerabilities",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/vulnerabilities?status=open&severity=critical",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "vulnerabilities"],
                                                        "query": [
                                                                {
                                                                        "key": "status",
                                                                        "value": "open",
                                                                        "description": "open, patching, resolved"
                                                                },
                                                                {
                                                                        "key": "severity",
                                                                        "value": "critical",
                                                                        "description": "critical, high, medium, low"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Vulnerability by ID",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/vulnerabilities/:vuln_id",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "vulnerabilities", ":vuln_id"],
                                                        "variable": [
                                                                {
                                                                        "key": "vuln_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Patch Vulnerability",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/vulnerabilities/:vuln_id/patch",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "vulnerabilities", ":vuln_id", "patch"],
                                                        "variable": [
                                                                {
                                                                        "key": "vuln_id",
                                                                        "value": "1"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "11. Analytics",
                        "item": [
                                {
                                        "name": "Get Incidents Analytics",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/analytics/incidents?hours=24",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "analytics", "incidents"],
                                                        "query": [
                                                                {
                                                                        "key": "hours",
                                                                        "value": "24"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Response Time Analytics",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/analytics/response-time?days=7",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "analytics", "response-time"],
                                                        "query": [
                                                                {
                                                                        "key": "days",
                                                                        "value": "7"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Vulnerability Distribution",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/analytics/vulnerability-distribution",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "analytics", "vulnerability-distribution"]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Get Analytics Summary",
                                        "request": {
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "Authorization",
                                                                "value": "Bearer {{access_token}}"
                                                        }
                                                ],
                                                "url": {
                                                        "raw": "{{base_url}}/api/analytics/summary",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "analytics", "summary"]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "12. Voice (Voz)",
                        "item": [
                                {
                                        "name": "Transcribe Audio (Speech-to-Text)",
                                        "request": {
                                                "method": "POST",
                                                "header": [],
                                                "body": {
                                                        "mode": "formdata",
                                                        "formdata": [
                                                                {
                                                                        "key": "audio",
                                                                        "type": "file",
                                                                        "src": "/ruta/al/audio.wav",
                                                                        "description": "Archivo de audio (WAV, MP3, OGG, M4A, FLAC, WEBM)"
                                                                },
                                                                {
                                                                        "key": "companyId",
                                                                        "value": "1",
                                                                        "type": "text"
                                                                },
                                                                {
                                                                        "key": "agentAccessKey",
                                                                        "value": "{{agent_access_key}}",
                                                                        "type": "text"
                                                                }
                                                        ]
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/voice/transcribe",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "voice", "transcribe"]
                                                },
                                                "description": "Transcribe audio a texto usando Azure Speech.\n\nPARAMETROS (multipart/form-data):\n- audio: archivo de audio\n- companyId: ID de la empresa\n- agentAccessKey: Clave del agente"
                                        },
                                        "response": []
                                },
                                {
                                        "name": "Text to Speech (Sintetizar Voz)",
                                        "request": {
                                                "method": "POST",
                                                "header": [
                                                        {
                                                                "key": "Content-Type",
                                                                "value": "application/json"
                                                        }
                                                ],
                                                "body": {
                                                        "mode": "raw",
                                                        "raw": "{\n  \"text\": \"Hola, soy SOPHIA, tu asistente de ciberseguridad\",\n  \"companyId\": 1,\n  \"agentAccessKey\": \"{{agent_access_key}}\"\n}"
                                                },
                                                "url": {
                                                        "raw": "{{base_url}}/api/voice/speak",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["api", "voice", "speak"]
                                                },
                                                "description": "Convierte texto a audio usando Azure Speech. Retorna archivo MP3.\n\nPARAMETROS:\n- text: Texto a sintetizar\n- companyId: ID de la empresa\n- agentAccessKey: Clave del agente\n\nUsa la voz configurada en azureSpeechVoiceName del agente"
                                        },
                                        "response": []
                                }
                        ]
                },
                {
                        "name": "13. Health",
                        "item": [
                                {
                                        "name": "Health Check",
                                        "request": {
                                                "method": "GET",
                                                "header": [],
                                                "url": {
                                                        "raw": "{{base_url}}/health",
                                                        "host": ["{{base_url}}"],
                                                        "path": ["health"]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                }
        ],
        "event": [
                {
                        "listen": "prerequest",
                        "script": {
                                "type": "text/javascript",
                                "exec": [
                                        ""
                                ]
                        }
                },
                {
                        "listen": "test",
                        "script": {
                                "type": "text/javascript",
                                "exec": [
                                        ""
                                ]
                        }
                }
        ],
        "variable": [
                {
                        "key": "base_url",
                        "value": "http://localhost:5000",
                        "type": "string"
                },
                {
                        "key": "access_token",
                        "value": "",
                        "type": "string",
                        "description": "JWT del usuario (se auto-guarda al hacer login/register)"
                },
                {
                        "key": "refresh_token",
                        "value": "",
                        "type": "string"
                },
                {
                        "key": "agent_access_key",
                        "value": "",
                        "type": "string",
                        "description": "Clave del agente (se auto-guarda al crear instancia)"
                },
                {
                        "key": "agent_instance_id",
                        "value": "",
                        "type": "string",
                        "description": "ID de la instancia del agente"
                },
                {
                        "key": "agent_token",
                        "value": "",
                        "type": "string",
                        "description": "JWT del agente (se auto-guarda al autenticar agente)"
                }
        ]
}
