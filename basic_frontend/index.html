<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TxDxAI - API Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #34495e;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #2980b9;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .token-display {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-left: 3px solid #3498db;
            word-break: break-all;
            font-size: 12px;
        }
        .error {
            background: #fee;
            border-left-color: #e74c3c;
        }
        .success {
            background: #efe;
            border-left-color: #27ae60;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí TxDxAI API Test Interface</h1>
        <p class="subtitle">Multi-tenant Cybersecurity & Ticket Automation Backend</p>

        <div id="tokenDisplay" class="token-display" style="display: none;">
            <strong>Access Token:</strong> <span id="tokenValue"></span>
        </div>

        <div class="section">
            <h2>üîê Authentication</h2>
            <div class="grid">
                <div>
                    <h3>Register (ADMIN)</h3>
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="regCompany" placeholder="Acme Corp">
                    </div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="admin">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="admin@acme.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="password">
                    </div>
                    <button onclick="register()">Register</button>
                </div>
                <div>
                    <h3>Login</h3>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginUsername" placeholder="admin">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="password">
                    </div>
                    <button onclick="login()">Login</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üé´ Tickets</h2>
            <div class="grid">
                <div>
                    <h3>Create Ticket</h3>
                    <div class="form-group">
                        <label>Subject</label>
                        <input type="text" id="ticketSubject" placeholder="Security Alert">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="ticketDescription" placeholder="Describe the issue..."></textarea>
                    </div>
                    <button onclick="createTicket()">Create Ticket</button>
                </div>
                <div>
                    <h3>Get Tickets</h3>
                    <div class="form-group">
                        <label>Status Filter (Optional)</label>
                        <select id="ticketStatus">
                            <option value="">All</option>
                            <option value="PENDING">PENDING</option>
                            <option value="EXECUTED">EXECUTED</option>
                            <option value="FAILED">FAILED</option>
                            <option value="DERIVED">DERIVED</option>
                        </select>
                    </div>
                    <button onclick="getTickets()">Get Tickets</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üîå Integrations</h2>
            <div class="grid">
                <div>
                    <h3>Create Integration</h3>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="integrationProvider">
                            <option value="palo_alto">Palo Alto</option>
                            <option value="splunk">Splunk</option>
                            <option value="wazuh">Wazuh</option>
                            <option value="meraki">Meraki</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="integrationName" placeholder="prod-instance">
                    </div>
                    <div class="form-group">
                        <label>Credentials (JSON)</label>
                        <textarea id="integrationCredentials" placeholder='{"api_key": "your-key"}'></textarea>
                    </div>
                    <button onclick="createIntegration()">Create Integration</button>
                </div>
                <div>
                    <h3>Get Integrations</h3>
                    <button onclick="getIntegrations()">Get Integrations</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üë• Users</h2>
            <button onclick="getUsers()">Get Users</button>
            <button onclick="getCompany()">Get Company</button>
        </div>

        <div class="section">
            <h2>üñ•Ô∏è Systems</h2>
            <button onclick="getSystemStatus()">Get System Status</button>
            <button onclick="getAllSystems()">Get All Systems</button>
        </div>

        <div class="section">
            <h2>üö® Alerts</h2>
            <div class="grid">
                <div>
                    <h3>Get Active Alerts</h3>
                    <div class="form-group">
                        <label>Limit</label>
                        <input type="number" id="alertLimit" value="100" placeholder="100">
                    </div>
                    <button onclick="getActiveAlerts()">Get Active Alerts</button>
                </div>
                <div>
                    <h3>Resolve Alert</h3>
                    <div class="form-group">
                        <label>Alert ID</label>
                        <input type="number" id="resolveAlertId" placeholder="1">
                    </div>
                    <button onclick="resolveAlert()">Resolve Alert</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üõ°Ô∏è Vulnerabilities</h2>
            <div class="grid">
                <div>
                    <h3>Get Vulnerabilities</h3>
                    <div class="form-group">
                        <label>Status Filter (Optional)</label>
                        <select id="vulnStatus">
                            <option value="">All</option>
                            <option value="open">Open</option>
                            <option value="patching">Patching</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Severity Filter (Optional)</label>
                        <select id="vulnSeverity">
                            <option value="">All</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <button onclick="getVulnerabilities()">Get Vulnerabilities</button>
                </div>
                <div>
                    <h3>Patch Vulnerability</h3>
                    <div class="form-group">
                        <label>Vulnerability ID</label>
                        <input type="number" id="patchVulnId" placeholder="1">
                    </div>
                    <button onclick="patchVulnerability()">Initiate Patch</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìä Analytics</h2>
            <div class="grid">
                <div>
                    <h3>Incident Analytics</h3>
                    <div class="form-group">
                        <label>Hours</label>
                        <input type="number" id="incidentHours" value="24" placeholder="24">
                    </div>
                    <button onclick="getIncidentAnalytics()">Get Incident Analytics</button>
                </div>
                <div>
                    <h3>Response Time Analytics</h3>
                    <div class="form-group">
                        <label>Days</label>
                        <input type="number" id="responseTimeDays" value="7" placeholder="7">
                    </div>
                    <button onclick="getResponseTimeAnalytics()">Get Response Time</button>
                </div>
            </div>
            <div class="grid">
                <div>
                    <button onclick="getVulnDistribution()">Get Vulnerability Distribution</button>
                </div>
                <div>
                    <button onclick="getAnalyticsSummary()">Get Analytics Summary</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìã Response</h2>
            <div id="response" class="response">No request sent yet...</div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let accessToken = '';

        function setToken(token) {
            accessToken = token;
            document.getElementById('tokenDisplay').style.display = 'block';
            document.getElementById('tokenValue').textContent = token.substring(0, 50) + '...';
        }

        function showResponse(data, isError = false) {
            const responseDiv = document.getElementById('response');
            responseDiv.textContent = JSON.stringify(data, null, 2);
            responseDiv.className = 'response ' + (isError ? 'error' : 'success');
        }

        async function apiRequest(method, endpoint, body = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (accessToken) {
                    options.headers['Authorization'] = `Bearer ${accessToken}`;
                }

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(API_BASE + endpoint, options);
                const data = await response.json();

                if (response.ok) {
                    showResponse(data);
                    return data;
                } else {
                    showResponse(data, true);
                    return null;
                }
            } catch (error) {
                showResponse({ error: error.message }, true);
                return null;
            }
        }

        async function register() {
            const data = await apiRequest('POST', '/auth/register', {
                company_name: document.getElementById('regCompany').value,
                username: document.getElementById('regUsername').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value
            });
            if (data && data.access_token) {
                setToken(data.access_token);
            }
        }

        async function login() {
            const data = await apiRequest('POST', '/auth/login', {
                username: document.getElementById('loginUsername').value,
                password: document.getElementById('loginPassword').value
            });
            if (data && data.access_token) {
                setToken(data.access_token);
            }
        }

        async function createTicket() {
            await apiRequest('POST', '/tickets', {
                subject: document.getElementById('ticketSubject').value,
                description: document.getElementById('ticketDescription').value
            });
        }

        async function getTickets() {
            const status = document.getElementById('ticketStatus').value;
            const endpoint = status ? `/tickets?status=${status}` : '/tickets';
            await apiRequest('GET', endpoint);
        }

        async function createIntegration() {
            const credentials = document.getElementById('integrationCredentials').value;
            try {
                await apiRequest('POST', '/integrations', {
                    provider: document.getElementById('integrationProvider').value,
                    name: document.getElementById('integrationName').value,
                    credentials: JSON.parse(credentials)
                });
            } catch (e) {
                showResponse({ error: 'Invalid JSON in credentials' }, true);
            }
        }

        async function getIntegrations() {
            await apiRequest('GET', '/integrations');
        }

        async function getUsers() {
            await apiRequest('GET', '/users');
        }

        async function getCompany() {
            await apiRequest('GET', '/companies');
        }

        async function getSystemStatus() {
            await apiRequest('GET', '/systems/status');
        }

        async function getAllSystems() {
            await apiRequest('GET', '/systems');
        }

        async function getActiveAlerts() {
            const limit = document.getElementById('alertLimit').value;
            await apiRequest('GET', `/alerts/active?limit=${limit}`);
        }

        async function resolveAlert() {
            const alertId = document.getElementById('resolveAlertId').value;
            if (!alertId) {
                showResponse({ error: 'Please enter an Alert ID' }, true);
                return;
            }
            await apiRequest('POST', `/alerts/${alertId}/resolve`);
        }

        async function getVulnerabilities() {
            const status = document.getElementById('vulnStatus').value;
            const severity = document.getElementById('vulnSeverity').value;
            let endpoint = '/vulnerabilities?';
            if (status) endpoint += `status=${status}&`;
            if (severity) endpoint += `severity=${severity}&`;
            await apiRequest('GET', endpoint);
        }

        async function patchVulnerability() {
            const vulnId = document.getElementById('patchVulnId').value;
            if (!vulnId) {
                showResponse({ error: 'Please enter a Vulnerability ID' }, true);
                return;
            }
            await apiRequest('POST', `/vulnerabilities/${vulnId}/patch`);
        }

        async function getIncidentAnalytics() {
            const hours = document.getElementById('incidentHours').value;
            await apiRequest('GET', `/analytics/incidents?hours=${hours}`);
        }

        async function getResponseTimeAnalytics() {
            const days = document.getElementById('responseTimeDays').value;
            await apiRequest('GET', `/analytics/response-time?days=${days}`);
        }

        async function getVulnDistribution() {
            await apiRequest('GET', '/analytics/vulnerability-distribution');
        }

        async function getAnalyticsSummary() {
            await apiRequest('GET', '/analytics/summary');
        }
    </script>
</body>
</html>
